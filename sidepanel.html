<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="sidepanel.dist.css">
</head>

<body class="bg-neutral-950 text-gray-200 font-sans text-sm p-4 flex flex-col h-screen overflow-hidden">
    <h2>
        AI Roundtable ğŸ›¡ï¸
        <div class="ml-auto flex gap-1.5">
            <button id="btn-lan-toggle" class="btn-mini" title="LAN / Multiplayer">ğŸ”—</button>
            <button id="btn-clear" class="btn-mini" title="Clear All Status">ğŸ—‘ï¸</button>
        </div>
    </h2>

    <!-- LAN Panel -->
    <div id="lan-panel" class="lan-panel hidden">
        <h3 class="mb-2 text-xs font-medium uppercase text-gray-500 tracking-wider">P2P Room</h3>

        <!-- Username -->
        <div class="mb-2 flex items-center gap-2">
            <span class="text-xs text-gray-400">Name:</span>
            <input type="text" id="my-username" class="lan-input mb-0 flex-1"
                placeholder="Your Name" value="">
        </div>

        <!-- Step 1: Mode Selection -->
        <div id="p2p-step-1" class="flex gap-1.5">
            <button id="btn-mode-host" class="btn-link flex-1 bg-neutral-800 hover:bg-neutral-700">ğŸ  Create Room</button>
            <button id="btn-mode-join" class="btn-link flex-1 bg-neutral-800 hover:bg-neutral-700">â¡ï¸ Join Room</button>
        </div>

        <!-- Step 2: Host View -->
        <div id="p2p-step-host" class="hidden mt-2">
            <div class="text-[11px] text-gray-400 mb-1">Your Room ID:</div>
            <div id="host-room-id"
                class="bg-black/50 p-2 text-green-400 font-mono text-center select-all border border-neutral-700 cursor-pointer rounded-lg hover:border-green-500/30 transition-colors"
                title="Click to copy">Generatine...</div>
            <div class="text-[10px] text-gray-500 text-center mt-1">(Share this with guests)</div>
        </div>

        <!-- Step 2: Guest View -->
        <div id="p2p-step-guest" class="hidden mt-2">
            <input type="text" id="guest-room-input" class="lan-input" placeholder="Paste Room ID here...">
            <button id="btn-guest-connect" class="btn-link w-full bg-blue-600 hover:bg-blue-500 text-white font-medium border-0 shadow-lg shadow-blue-900/20">Connect</button>
        </div>

        <!-- Advanced Settings (PeerServer) -->
        <details class="mt-2.5 border border-white/5 rounded-lg p-1.5 bg-black/10">
            <summary class="text-[10px] text-gray-500 cursor-pointer outline-none select-none hover:text-gray-300">Advanced: Custom Server</summary>
            <div class="mt-2 flex flex-col gap-1.5">
                <input type="text" id="p2p-host" class="lan-input" placeholder="Host (e.g. 0.peerjs.com)" value="">
                <div class="flex gap-1.5">
                    <input type="number" id="p2p-port" class="lan-input" placeholder="Port (e.g. 443)" value="">
                    <input type="text" id="p2p-path" class="lan-input" placeholder="Path (e.g. /)" value="">
                </div>
                <div class="text-[10px] text-gray-600">Leave empty to use default public server.</div>
            </div>
        </details>

        <div id="lan-status-msg" class="lan-status mt-3 border-t border-white/5 pt-2">
            Offline</div>

        <!-- Room Roster -->
        <div id="room-roster" class="hidden mt-3 border-t border-dashed border-white/10 pt-2">
            <div class="text-[10px] text-gray-500 mb-2 uppercase tracking-wide">Room Members</div>
            <div id="roster-list" class="flex flex-col gap-1.5">
                <!-- Members injected here -->
            </div>
        </div>
    </div>

    <div class="status-panel">
        <div class="flex justify-between items-center mb-2">
            <span class="text-[11px] font-medium text-neutral-500 uppercase tracking-wider">Participants</span>
            <button id="btn-scan" class="btn-link text-[10px] py-1 px-2">ğŸ”„ Scan Tabs</button>
        </div>

        <div id="active-agents-list">
            <div class="text-xs text-neutral-500 text-center p-3 italic">Please click Scan to find AI tabs.
            </div>
        </div>
        <div id="status-gpt" class="status-dot hidden"></div>
    </div>
    </div>

    <div class="toolbar">
        <span>War Room Log</span>
        <button id="btn-rollcall" class="btn-link text-[10px]">ğŸ“¢ Roll Call</button>
    </div>

    <div class="chat-stream" id="chat-stream">
        <div id="empty-state" class="message-block text-center text-neutral-500 italic py-8">
            <div class="text-2xl mb-2 grayscale opacity-20">ğŸ›¡ï¸</div>
            War Room initialized.
            <br>Waiting for orders.
        </div>
    </div>

    <div class="controls">
        <div class="toggle-row">
            <input type="checkbox" id="chk-include-history" checked class="accent-purple-600">
            <label for="chk-include-history" title="Send previous chat history as context">Include History</label>

            <span class="border-l border-neutral-700 h-3 mx-1"></span>

            <input type="checkbox" id="chk-smart-context" checked class="accent-purple-600">
            <label for="chk-smart-context"
                title="Exclude an agent's own previous messages from the context sent to them">Smart Context</label>
        </div>

        <textarea id="prompt-input" placeholder="Type instructions for the council..."></textarea>
        <div class="flex gap-2">
            <button id="btn-distribute" class="btn-broadcast flex-1">ğŸ“¡ Distribute</button>
            <button id="btn-collect" class="btn-harvest flex-1">ğŸ“¥ Collect</button>
        </div>
    </div>

    <script src="lib/peerjs.min.js"></script>
    <script type="module" src="src/main.js"></script>
</body>

</html>